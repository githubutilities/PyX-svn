\section{\TeX/\LaTeX{} interface}
\subsection{Methods}
\label{tex}
Text in \PyX{} is created by \TeX{} or \LaTeX. From the technical point
of view, the text is inserted as an eps-file. This epsfile is generated
by the module \verb|tex| which runs \TeX{} or \LaTeX{} followed by
\verb|dvips| to create the requested text. \TeX-runs are performed by
instances of the class \verb|tex.tex| while \LaTeX-runs are done by
\verb|tex.latex|. Up to the constructor and the advanced possibilities
for the commands performed in \LaTeX{} both classes \verb|tex.tex| and
\verb|tex.latex| are identical. They provide 5 methods to the user
listed in the following table:

\bigskip
\begin{tabularx}{\linewidth}{ll>{\raggedright\arraybackslash}X}
method&task&attributes\\
\hline
\texttt{text(x, y, cmd, *style)}&text output&\texttt{style, fontsize, halign, valign, direction, color, msghandler(s)}\\
\texttt{define(cmd, *style)}&macro definitions&\texttt{msghandler(s)}\\
\texttt{textwd(cmd, *style)}&get text width&\texttt{style, fontsize, missextent, msghandler(s)}\\
\texttt{textht(cmd, *style)}&get text height&\texttt{style, fontsize, valign, missextent, msghandler(s)}\\
\texttt{textdp(cmd, *style)}&get text depth&\texttt{style, fontsize, valign, missextent, msghandler(s)}\\
\end{tabularx}
\bigskip

There are some common rules:
\begin{itemize}
\item \verb|define| can only called before any other of the methods. For
\LaTeX{} the definitions are processed before the \verb|\begin{document}|
statement. You may use \verb|\AtBeginDocument{...}| to postpone definitions.
\item The extent routines \verb|textwd|, \verb|textht|, and
\verb|textdp| return true \PyX{} length (see section~\ref{length}).
Usually, the evaluation takes place when performing a write. Therefore
you have to run your file twice at first to get the correct value,
which are stored in a file named \verb|.size|. However, when a extent
is requested, which is not available, this default behavior can be
changed (see \verb|missextent| attribute description).
\item Commands are done in the order they are called with one exception:
if the same text output is requested more then once (calculating extents
of the command included), all requests are performed at the position of
the first occurrence.
\item All text is inserted into the \verb|canvas| at the position, where
the \verb|tex|- or \verb|latex|-instance itself is inserted into the
\verb|canvas|.
\item The tailing \verb|*style| parameter in all the commands stands
for a list of attribute parameters listed in the last column.
Attribute parameters are instances of classes discussed in detail in
the following section.
\item There can be several \verb|msghandler|'s which will be applied
sequentially.
\end{itemize}


\subsection{Attributes}
\begin{description}
\item[\texttt{style:}] \verb|tex.style.text| (default -- does nothing to
the command),\\\verb|tex.style.math| (switches to math mode in
\verb|\displaystyle|)
\item[\texttt{fontsize:}] specifies the \LaTeX-fontsizes by
\verb|tex.fontsize.xxx| where \verb|xxx| is
\verb|tiny|,
\verb|scriptsize|,
\verb|footnotesize|,
\verb|small|,
\verb|normalsize| (default),
\verb|large|,
\verb|Large|,
\verb|LARGE|,
\verb|huge|, or
\verb|Huge|.
\item[\texttt{halign:}] \verb|tex.halign.left| (default),
\verb|tex.halign.center|, \verb|tex.halign.right|
\item[\texttt{valign:}] \verb|tex.valign.top(length)| or
\verb|tex.valign.bottom(length)| --- creates a vertical box with width
\verb|length|. The vertical alignment is the baseline of the first line
for \verb|top| and the last line for \verb|bottom|. The box width is
stored in the \TeX{} dimension \verb|\linewidth|.
\item[\texttt{direction:}] \verb|tex.direction.xxx| where \verb|xxx| is
one of \verb|horizontal| (default), \verb|vertical|, \verb|upsidedown|,
or \verb|rvertical|. Additionally, any angle \verb|angle| (in degree) is
allowed in \verb|tex.direction(angle)|.
\item[\texttt{color:}] stands for any \PyX{} color (see
section~\ref{color}), default is \verb|color.grey.black|
\item[\texttt{missextent:}] provides a routine, which is called when a
requested extent is not yet available. In the following table a list
of choises for this parameter is described:

\bigskip
\begin{tabularx}{\linewidth}{l>{\raggedright\arraybackslash}X}
missextent&description\\
\hline
\texttt{missextent.returnzero}&returns zero (default)\\
\texttt{missextent.raiseerror}&raise \texttt{TexMissExtentError}\\
\texttt{missextent.createextent}&run \TeX{} or \LaTeX{} immediately to
get the requested size\\
\texttt{missextent.createallextent}&run \TeX{} or \LaTeX{} immediately
to get the hight, width, and depth of the given text at once\\
\end{tabularx}
\item[\texttt{msghandler:}] provides a filter for \TeX{} and \LaTeX{}
messages and defines, which messages are hidden. In the following table
the predefined message handlers are described:

\bigskip
\begin{tabularx}{\linewidth}{l>{\raggedright\arraybackslash}X}
msghandler&description\\
\hline
\texttt{msghandler.showall}&shows all messages\\
\texttt{msghandler.hideload}&Hides messages which are written when loading
packages and including other files. They look like \texttt{(file...)}
where \texttt{file} is a readable file and \texttt{...} stands for any
text. This message handler is the default handler.\\
\texttt{msghandler.hidegraphicsload}&Hides messages which are written by
\texttt{includegraphics} of the \texttt{graphicx} package. They look like
\texttt{<file>} where \texttt{file} is a readable file.\\
\texttt{msghandler.hidefontwarning}&Hides \LaTeX{} font warnings. They
look like \texttt{LaTeX Font Warning:} and are followed by lines starting
with \texttt{(Font)}.\\
\texttt{msghandler.hidebuterror}&Hides messages except those
with a line which starts with ``\texttt{! }''.\\
\texttt{msghandler.hideall}&hides all messages\\
\end{tabularx}
\end{description}

\subsection{Constructors}
%The constructors of class \verb|tex.tex| and \verb|tex.latex| can have some
%named parameters listed in the following table:

\bigskip
\begin{tabularx}{\linewidth}{ll>{\raggedright\arraybackslash}X}
common parameters&default&description\\
\hline
\texttt{defaultmsghandler}&\texttt{msghandler.hideload}&default message handler\\
\texttt{defaultmissextent}&\texttt{missextent.returnzero}&default
miss-extent handler\\
\texttt{texfilename}&\texttt{None}&Filename used for running tex. If
\texttt{None}, a temporary name is used and the files are removed automatically.\\
\hline
class \texttt{tex.tex}&&\\
\hline
\texttt{lts}&\texttt{"10pt"}&Specifies a latex font size. Those files are created
by \texttt{createlfs.tex} (included in the \PyX{} distribution). Available values
are shown whenever a requested size is not found.\\
\hline
class \texttt{tex.latex}&&\\
\hline
\texttt{docclass}&\texttt{"article"}&specify the document class\\
\texttt{docopt}&\texttt{None}&specifies options to the document class\\
\texttt{auxfilename}&\texttt{None}&Specifies a filename for storing the \LaTeX{}
\texttt{aux} file. This is needed when using labels and references.\\
\end{tabularx}

\subsection{Examples}
\subsubsection{Example 1}
\begin{verbatim}
import pyx
c=canvas.canvas()
t=c.insert(tex.tex())
t.text(0, 0, "Hello, world!")
print "width:", t.textwd("Hello, world!")
print "height:", t.textht("Hello, world!")
print "depth:", t.textdp("Hello, world!")
c.writetofile("tex_ex1")
\end{verbatim}

The output of this program is:
\begin{verbatim}
width: (0.019535 t + 0.000000 u + 0.000000 v + 0.000000 w) m
height: (0.002441 t + 0.000000 u + 0.000000 v + 0.000000 w) m
depth: (0.000683 t + 0.000000 u + 0.000000 v + 0.000000 w) m
\end{verbatim}

The file \verb|tex_ex1.eps| is created and looks like:

\bigskip
\includegraphics{tex_ex1}

\subsubsection{Example 2}
\begin{verbatim}
import pyx
c=canvas.canvas()
t=c.insert(tex.tex())
t.text(0, 0, "Hello, world!")
t.text(0, -0.5, "Hello, world!", tex.fontsize.large)
t.text(0, -1.5,
       r"\sum_{n=1}^{\infty} {1\over{n^2}} = {{\pi^2}\over 6}",
       tex.style.math)

c.draw(path.line(5, -0.5, 9, -0.5))
c.draw(path.line(5, -1, 9, -1))
c.draw(path.line(5, -1.5, 9, -1.5))
c.draw(path.line(7, -1.5, 7, 0))
t.text(7, -0.5, "left aligned") # default is tex.halign.left
t.text(7, -1, "center aligned", tex.halign.center)
t.text(7, -1.5, "right aligned", tex.halign.right)

c.draw(path.line(0, -4, 2, -4))
c.draw(path.line(0, -2.5, 0, -5.5))
c.draw(path.line(2, -2.5, 2, -5.5))
t.text(0, -4,
       "a b c d e f g h i j k l m n o p q r s t u v w x y z",
       tex.valign.top(2))
c.draw(path.line(2.5, -4, 4.5, -4))
c.draw(path.line(2.5, -2.5, 2.5, -5.5))
c.draw(path.line(4.5, -2.5, 4.5, -5.5))
t.text(2.5, -4,
       "a b c d e f g h i j k l m n o p q r s t u v w x y z",
       tex.valign.bottom(2))

c.draw(path.line(5, -4, 9, -4))
c.draw(path.line(7, -5.5, 7, -2.5))
t.text(7, -4, "horizontal")
t.text(7, -4, "vertical", tex.direction.vertical)
t.text(7, -4, "rvertical", tex.direction.rvertical)
t.text(7, -4, "upsidedown", tex.direction.upsidedown)
t.text(7.5, -3.5, "45", tex.direction(45))
t.text(6.5, -3.5, "135", tex.direction(135))
t.text(6.5, -4.5, "225", tex.direction(225))
t.text(7.5, -4.5, "315", tex.direction(315))

t.text(0, -6, "red", color.rgb.red)
t.text(3, -6, "green", color.rgb.green)
t.text(6, -6, "blue", color.rgb.blue)
c.writetofile("tex_ex2")
\end{verbatim}

The file \verb|tex_ex2.eps| is created and looks like:

\bigskip
\includegraphics{tex_ex2}

\subsection{Implementation details}
to be written

\subsection{Known bugs}
\begin{itemize}
\item The end of the last paragraph in a vertical box
(\verb|tex.valign.top| and \verb|tex.valign.bottom|) must be explictly
written (by the command \verb|\par| or an empty line) when a paragraph
formating parameter is changed locally (like \verb|\baselineskip| or a
font size change).  Otherwise, the information is thrown away due to
closing of the box before the paragraph formatting is performed.
\item Due to \verb|dvips| the bounding box is wrong for rotated text.
The rotation is just ignored in the bounding box calculation.
\end{itemize}
